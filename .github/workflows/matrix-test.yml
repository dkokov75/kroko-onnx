name: Manual test on real Raspberry Pi

on:
  workflow_dispatch:

jobs:
  test-on-pi:
    runs-on: [self-hosted, raspberrypi, arm64]

    steps:
      - uses: actions/checkout@v4

      - name: Setup Python venv
        run: |
          python3 -m venv venv
          source venv/bin/activate
          pip install --upgrade pip setuptools wheel

      - name: Install from TestPyPI
        run: |
          source venv/bin/activate
          pip install -i https://test.pypi.org/simple/ kroko-onnx-2

      - name: CLI test
        run: |
          source venv/bin/activate
          sherpa-onnx --help

      - name: Python import test
        run: |
          source venv/bin/activate
          python -c "import kroko_onnx; print('OK on real Raspberry Pi')"
